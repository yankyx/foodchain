<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>食物链搭建模拟器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36CFC9',
                        accent: '#722ED1',
                        warning: '#FF7D00',
                        danger: '#F53F3F',
                        success: '#00B42A',
                        neutral: '#86909C',
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                },
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .drag-item {
                @apply cursor-move transition-all duration-200 hover:scale-110 hover:shadow-lg;
            }
            .drop-zone {
                @apply border-2 border-dashed border-primary/30 transition-all duration-200;
            }
            .drop-zone-active {
                @apply border-primary bg-primary/5;
            }
            .creature-icon {
                @apply flex items-center justify-center w-14 h-14 text-3xl bg-white rounded-full shadow-md transition-all duration-300 hover:shadow-lg;
            }
            .btn-level {
                @apply px-3 py-2 rounded-md transition-all duration-200 text-sm font-medium;
            }
            .btn-level-active {
                @apply bg-primary text-white;
            }
            .btn-level-inactive {
                @apply bg-gray-100 text-gray-600 hover:bg-gray-200;
            }
        }
        /* 修复CSS兼容性警告 */
        :host, html {
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }
    </style>
</head>
<body class="font-inter bg-gray-50 min-h-screen flex flex-col overflow-hidden">
    <header class="bg-white shadow-sm py-3 px-4 sm:px-6 lg:px-8 flex items-center justify-between z-10">
        <div class="flex items-center space-x-2">
            <i class="fa fa-link text-primary text-xl"></i>
            <h1 class="text-[clamp(1.2rem,3vw,1.8rem)] font-bold text-gray-900">食物链搭建模拟器</h1>
        </div>
        <div id="info-panel" class="text-sm text-gray-600 bg-blue-50 px-3 py-1.5 rounded-md hidden items-center space-x-1 max-w-xs">
            <i class="fa fa-info-circle text-primary"></i>
            <span id="info-message">将被捕食者拖拽到捕食者上建立关系</span>
        </div>
    </header>

    <main class="flex-1 flex flex-col md:flex-row overflow-hidden p-3 md:p-4 gap-3">
        <div class="w-full md:w-72 bg-white rounded-lg shadow-sm p-4 flex flex-col gap-4 overflow-hidden">
            <div class="space-y-2">
                <h2 class="text-lg font-semibold text-gray-800 flex items-center">
                    <i class="fa fa-list-ol text-primary mr-2"></i>关卡选择
                </h2>
                <div id="level-selector" class="grid grid-cols-5 gap-2 max-h-28 overflow-y-auto p-1 bg-gray-50 rounded-md">
                    </div>
                <button id="check-btn" class="w-full mt-2 bg-primary hover:bg-primary/90 text-white py-2 rounded-md transition-all duration-200 flex items-center justify-center gap-2">
                    <i class="fa fa-check-circle"></i>
                    <span>检查食物链</span>
                </button>
            </div>

            <div class="flex-1 flex flex-col overflow-hidden">
                <h2 class="text-lg font-semibold text-gray-800 flex items-center mb-2">
                    <i class="fa fa-paw text-primary mr-2"></i>可用生物
                </h2>
                <div id="creatures-container" class="flex-1 grid grid-cols-3 sm:grid-cols-4 gap-2 p-2 bg-gray-50 rounded-md overflow-y-auto">
                    </div>
            </div>
        </div>

        <div class="flex-1 bg-white rounded-lg shadow-sm p-3 overflow-hidden flex flex-col">
            <h2 class="text-lg font-semibold text-gray-800 flex items-center mb-2 px-2">
                <i class="fa fa-draw-polygon text-primary mr-2"></i>画布区域
            </h2>
            <div id="canvas" class="flex-1 drop-zone rounded-md relative overflow-auto bg-gray-50">
                </div>
            <div class="mt-2 text-xs text-gray-500 flex items-center justify-between px-2">
                <span>提示: 从左侧拖拽生物到画布，然后将被捕食者拖拽到捕食者上</span>
                <span id="level-info">当前关卡: 第1关</span>
            </div>
        </div>
    </main>

    <footer class="bg-white shadow-sm py-2 px-4 text-sm text-gray-500 flex items-center justify-between">
        <div>食物链搭建模拟器 &copy; 2023</div>
        <div id="status-bar">准备就绪</div>
    </footer>

    <script>
        // 生物数据 - 40种生物
        const creaturesData = [
            { id: 1, name: '草', emoji: '🌿', type: 'producer', prey: [] },
            { id: 2, name: '兔子', emoji: '🐰', type: 'consumer', prey: [1] },
            { id: 3, name: '狐狸', emoji: '🦊', type: 'consumer', prey: [2] },
            { id: 4, name: '狮子', emoji: '🦁', type: 'consumer', prey: [2, 3] },
            { id: 5, name: '老鼠', emoji: '🐭', type: 'consumer', prey: [1] },
            { id: 6, name: '蛇', emoji: '🐍', type: 'consumer', prey: [2, 5] },
            { id: 7, name: '鹰', emoji: '🦅', type: 'consumer', prey: [2, 5, 6] },
            { id: 8, name: '蚂蚁', emoji: '🐜', type: 'consumer', prey: [1] },
            { id: 9, name: '蜘蛛', emoji: '🕷️', type: 'consumer', prey: [8] },
            { id: 10, name: '鸟', emoji: '🐦', type: 'consumer', prey: [8] },
            { id: 11, name: '鱼', emoji: '🐟', type: 'consumer', prey: [12] },
            { id: 12, name: '浮游生物', emoji: '🦠', type: 'producer', prey: [] },
            { id: 13, name: '青蛙', emoji: '🐸', type: 'consumer', prey: [8, 10] },
            { id: 14, name: '鳄鱼', emoji: '🐊', type: 'consumer', prey: [2, 13, 15] },
            { id: 15, name: '鹿', emoji: '🦌', type: 'consumer', prey: [1] },
            { id: 16, name: '狼', emoji: '🐺', type: 'consumer', prey: [2, 15] },
            { id: 17, name: '熊', emoji: '🐻', type: 'consumer', prey: [2, 3, 15] },
            { id: 18, name: '蜜蜂', emoji: '🐝', type: 'consumer', prey: [1] },
            { id: 19, name: '蝴蝶', emoji: '🦋', type: 'consumer', prey: [1] },
            { id: 20, name: '猫头鹰', emoji: '🦉', type: 'consumer', prey: [5, 9] },
            { id: 21, name: '蜈蚣', emoji: '🐛', type: 'consumer', prey: [8] },
            { id: 22, name: '蜥蜴', emoji: '🦎', type: 'consumer', prey: [8, 21] },
            { id: 23, name: '龟', emoji: '🐢', type: 'consumer', prey: [12, 11] },
            { id: 24, name: '虾', emoji: '🦐', type: 'consumer', prey: [12] },
            { id: 25, name: '蟹', emoji: '🦀', type: 'consumer', prey: [12, 24] },
            { id: 26, name: '章鱼', emoji: '🐙', type: 'consumer', prey: [11, 24, 25] },
            { id: 27, name: '海鸟', emoji: '🐦‍⬛', type: 'consumer', prey: [11, 24] },
            { id: 28, name: '豹子', emoji: '🐆', type: 'consumer', prey: [2, 15] },
            { id: 29, name: '大象', emoji: '🐘', type: 'consumer', prey: [1] },
            { id: 30, name: '犀牛', emoji: '🦏', type: 'consumer', prey: [1] },
            { id: 31, name: '河马', emoji: '🦛', type: 'consumer', prey: [1] },
            { id: 32, name: '长颈鹿', emoji: '🦒', type: 'consumer', prey: [1] },
            { id: 33, name: '斑马', emoji: '🦓', type: 'consumer', prey: [1] },
            { id: 34, name: '猴子', emoji: '🐒', type: 'consumer', prey: [1] },
            { id: 35, name: '猩猩', emoji: '🦧', type: 'consumer', prey: [1] },
            { id: 36, name: '熊猫', emoji: '🐼', type: 'consumer', prey: [1] },
            { id: 37, name: '袋鼠', emoji: '🦘', type: 'consumer', prey: [1] },
            { id: 38, name: '考拉', emoji: '🐨', type: 'consumer', prey: [1] },
            { id: 39, name: '企鹅', emoji: '🐧', type: 'consumer', prey: [11, 24] },
            { id: 40, name: '鲸鱼', emoji: '🐋', type: 'consumer', prey: [11, 24, 26] }
        ];

        const levels = Array.from({ length: 10 }, (_, i) => ({
            level: i + 1,
            creatureCount: 4 + i * 2,
            creatureIds: creaturesData.slice(0, 4 + i * 2).map(c => c.id)
        }));

        const gameState = {
            currentLevel: 1,
            canvasCreatures: new Map(),
            connections: new Set(),
            draggingElement: null,
            draggedCreatureId: null
        };

        const levelSelector = document.getElementById('level-selector');
        const creaturesContainer = document.getElementById('creatures-container');
        const canvas = document.getElementById('canvas');
        const checkBtn = document.getElementById('check-btn');
        const statusBar = document.getElementById('status-bar');
        const levelInfo = document.getElementById('level-info');
        const infoPanel = document.getElementById('info-panel');
        const infoMessage = document.getElementById('info-message');

        function initLevelSelector() {
            levelSelector.innerHTML = '';
            levels.forEach(level => {
                const button = document.createElement('button');
                button.className = `btn-level ${level.level === gameState.currentLevel ? 'btn-level-active' : 'btn-level-inactive'}`;
                button.textContent = level.level;
                button.addEventListener('click', () => { if (level.level !== gameState.currentLevel) switchLevel(level.level); });
                levelSelector.appendChild(button);
            });
        }

        function switchLevel(levelNum) {
            if (levelNum < 1 || levelNum > levels.length) return;
            canvas.innerHTML = '';
            gameState.canvasCreatures.clear();
            gameState.connections.clear();
            gameState.currentLevel = levelNum;
            levelInfo.textContent = `当前关卡: 第${levelNum}关`;
            document.querySelectorAll('.btn-level').forEach((btn, i) => {
                btn.className = `btn-level ${(i + 1) === levelNum ? 'btn-level-active' : 'btn-level-inactive'}`;
            });
            updateCreaturesContainer();
            showStatus(`已切换到第${levelNum}关，包含${levels[levelNum - 1].creatureCount}种生物`);
        }

        function updateCreaturesContainer() {
            creaturesContainer.innerHTML = '';
            const currentLevelCreatures = levels[gameState.currentLevel - 1].creatureIds;
            creaturesData
                .filter(creature => currentLevelCreatures.includes(creature.id))
                .forEach(creature => {
                    const creatureElement = createCreatureElement(creature, false);
                    creatureElement.classList.add('drag-item');
                    creatureElement.setAttribute('draggable', 'true');
                    creatureElement.addEventListener('dragstart', (e) => {
                        gameState.draggingElement = creatureElement;
                        gameState.draggedCreatureId = creature.id;
                        e.dataTransfer.setData('text/plain', creature.id);
                        e.dataTransfer.effectAllowed = 'copyMove';
                        setTimeout(() => creatureElement.classList.add('opacity-50'), 0);
                    });
                    creatureElement.addEventListener('dragend', () => {
                        gameState.draggingElement = null;
                        gameState.draggedCreatureId = null;
                        creatureElement.classList.remove('opacity-50');
                    });
                    creaturesContainer.appendChild(creatureElement);
                });
        }

        function createCreatureElement(creature, isOnCanvas = true) {
            const container = document.createElement('div');
            container.className = 'relative';
            container.dataset.creatureId = creature.id;
            container.dataset.creatureName = creature.name;
            const icon = document.createElement('div');
            icon.className = 'creature-icon';
            icon.textContent = creature.emoji;
            icon.title = creature.name;
            const name = document.createElement('div');
            name.className = 'text-xs text-center mt-1 whitespace-nowrap';
            name.textContent = creature.name;
            container.appendChild(icon);
            container.appendChild(name);
            return container;
        }

        function initCanvasDrop() {
            canvas.addEventListener('dragover', (e) => {
                e.preventDefault();
                canvas.classList.add('drop-zone-active');
                if (gameState.canvasCreatures.has(gameState.draggedCreatureId)) {
                    e.dataTransfer.dropEffect = 'move';
                } else {
                    e.dataTransfer.dropEffect = 'copy';
                }
            });

            canvas.addEventListener('dragleave', () => {
                canvas.classList.remove('drop-zone-active');
            });

            canvas.addEventListener('drop', (e) => {
                e.preventDefault();
                canvas.classList.remove('drop-zone-active');

                const creatureId = parseInt(e.dataTransfer.getData('text/plain'));
                if (isNaN(creatureId)) return;

                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left - 30;
                const y = e.clientY - rect.top - 30;

                if (gameState.canvasCreatures.has(creatureId)) {
                    const creatureState = gameState.canvasCreatures.get(creatureId);
                    creatureState.x = x;
                    creatureState.y = y;
                    creatureState.element.style.left = `${x}px`;
                    creatureState.element.style.top = `${y}px`;
                    updateConnections();
                    showStatus(`移动了 ${creatureState.element.dataset.creatureName}`);
                    return;
                }

                const creature = creaturesData.find(c => c.id === creatureId);
                if (creature) {
                    const creatureElement = createCreatureElement(creature);
                    creatureElement.style.position = 'absolute';
                    creatureElement.style.left = `${x}px`;
                    creatureElement.style.top = `${y}px`;
                    canvas.appendChild(creatureElement);
                    gameState.canvasCreatures.set(creatureId, {
                        element: creatureElement,
                        x: x,
                        y: y
                    });

                    creatureElement.setAttribute('draggable', 'true');
                    creatureElement.addEventListener('dragstart', (e) => {
                        gameState.draggingElement = creatureElement;
                        gameState.draggedCreatureId = creatureId;
                        e.dataTransfer.setData('text/plain', creatureId);
                        e.dataTransfer.effectAllowed = 'copyMove';
                        setTimeout(() => creatureElement.classList.add('opacity-50'), 0);
                    });

                    creatureElement.addEventListener('dragend', () => {
                        gameState.draggingElement = null;
                        gameState.draggedCreatureId = null;
                        creatureElement.classList.remove('opacity-50', 'ring-2', 'ring-primary');
                    });

                    creatureElement.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        if (gameState.draggingElement && gameState.draggingElement !== creatureElement) {
                            creatureElement.classList.add('ring-2', 'ring-primary');
                            e.dataTransfer.dropEffect = 'copy';
                        }
                    });

                    creatureElement.addEventListener('dragleave', () => {
                        creatureElement.classList.remove('ring-2', 'ring-primary');
                    });

                    creatureElement.addEventListener('drop', (e) => {
                        e.stopPropagation();
                        e.preventDefault();
                        creatureElement.classList.remove('ring-2', 'ring-primary');
                        const preyId = parseInt(e.dataTransfer.getData('text/plain'));
                        if (isNaN(preyId)) return;

                        const predatorId = parseInt(creatureElement.dataset.creatureId);
                        if (preyId === predatorId) {
                            showInfo(`生物不能捕食自己`);
                            return;
                        }

                        const predator = creaturesData.find(c => c.id === predatorId);
                        const prey = creaturesData.find(c => c.id === preyId);
                        if (predator && prey && predator.prey.includes(preyId)) {
                            const connectionKey = `${preyId}-${predatorId}`;
                            if (!gameState.connections.has(connectionKey)) {
                                gameState.connections.add(connectionKey);
                                createConnection(preyId, predatorId);
                                showInfo(`${prey.name} 被 ${predator.name} 捕食`);
                            } else {
                                showInfo(`这种捕食关系已经存在`);
                            }
                        } else {
                            showInfo(`${predator?.name || '未知生物'} 不能捕食 ${prey?.name || '未知生物'}`);
                        }
                    });
                    showStatus(`已添加 ${creature.name} 到画布`);
                }
            });
        }

        function createConnection(preyId, predatorId) {
            const prey = gameState.canvasCreatures.get(preyId);
            const predator = gameState.canvasCreatures.get(predatorId);
            if (!prey || !predator) return;

            let svg = document.querySelector('#canvas-svg');
            if (!svg) {
                svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.id = 'canvas-svg';

                // 【最终修复】不再使用className，而是用JS直接设置样式
                // 确保SVG图层能正确地撑满整个画布
                svg.style.position = 'absolute';
                svg.style.top = '0';
                svg.style.left = '0';
                svg.style.width = '100%';
                svg.style.height = '100%';
                svg.style.pointerEvents = 'none'; // 保持鼠标事件可以穿透
                svg.style.zIndex = '10';

                canvas.appendChild(svg);
            }

            const lineId = `connection-${preyId}-${predatorId}`;
            if (document.getElementById(lineId)) return;

            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.id = lineId;
            line.setAttribute('stroke', '#165DFF');
            line.setAttribute('stroke-width', '2');
            line.dataset.preyId = preyId;
            line.dataset.predatorId = predatorId;
            updateLinePosition(line, preyId, predatorId);

            let defs = svg.querySelector('defs');
            if (!defs) {
                defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
                svg.appendChild(defs);
            }
            if (!defs.querySelector('#arrowhead')) {
                const marker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
                marker.id = 'arrowhead';
                marker.setAttribute('viewBox', '0 0 10 10');
                marker.setAttribute('refX', '8');
                marker.setAttribute('refY', '5');
                marker.setAttribute('markerWidth', '6');
                marker.setAttribute('markerHeight', '6');
                marker.setAttribute('orient', 'auto');
                const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                polygon.setAttribute('points', '0 0, 10 5, 0 10');
                polygon.setAttribute('fill', '#165DFF');
                marker.appendChild(polygon);
                defs.appendChild(marker);
            }
            line.setAttribute('marker-end', 'url(#arrowhead)');
            svg.appendChild(line);
        }

        function updateLinePosition(line, preyId, predatorId) {
            const prey = gameState.canvasCreatures.get(preyId);
            const predator = gameState.canvasCreatures.get(predatorId);
            if (!prey || !predator) return;

            const preyX = prey.x + 28;
            const preyY = prey.y + 28;
            const predatorX = predator.x + 28;
            const predatorY = predator.y + 28;
            const dx = predatorX - preyX;
            const dy = predatorY - preyY;
            const distance = Math.sqrt(dx * dx + dy * dy);

            if (distance === 0) return;

            const startOffset = 28;
            const endOffset = 32;
            const startX = preyX + (dx / distance) * startOffset;
            const startY = preyY + (dy / distance) * startOffset;
            const endX = predatorX - (dx / distance) * endOffset;
            const endY = predatorY - (dy / distance) * endOffset;

            line.setAttribute('x1', startX);
            line.setAttribute('y1', startY);
            line.setAttribute('x2', endX);
            line.setAttribute('y2', endY);
        }

        function updateConnections() {
            const svg = document.querySelector('#canvas-svg');
            if (!svg) return;
            const lines = svg.querySelectorAll('line');
            lines.forEach(line => {
                const preyId = parseInt(line.dataset.preyId);
                const predatorId = parseInt(line.dataset.predatorId);
                updateLinePosition(line, preyId, predatorId);
            });
        }

        function checkFoodChain() {
            if (gameState.canvasCreatures.size === 0) {
                showStatus('画布上没有生物，请添加生物后再检查');
                return;
            }
            const currentLevel = levels[gameState.currentLevel - 1];
            const requiredCreatures = currentLevel.creatureIds;
            const canvasCreatureIds = Array.from(gameState.canvasCreatures.keys());
            const missingCreatures = requiredCreatures.filter(id => !canvasCreatureIds.includes(id));
            if (missingCreatures.length > 0) {
                const missingNames = missingCreatures.map(id => creaturesData.find(c => c.id === id)?.name || '未知生物').join(', ');
                showStatus(`请添加以下生物: ${missingNames}`);
                return;
            }
            const foodWeb = new Map();
            requiredCreatures.forEach(id => {
                foodWeb.set(id, { prey: new Set(), predators: new Set() });
            });
            gameState.connections.forEach(connection => {
                const [preyId, predatorId] = connection.split('-').map(Number);
                if (foodWeb.has(preyId) && foodWeb.has(predatorId)) {
                    foodWeb.get(predatorId).prey.add(preyId);
                    foodWeb.get(preyId).predators.add(predatorId);
                }
            });
            const producers = requiredCreatures.filter(id => creaturesData.find(c => c.id === id)?.type === 'producer');
            const consumers = requiredCreatures.filter(id => creaturesData.find(c => c.id === id)?.type === 'consumer');
            if (hasCycle(foodWeb)) {
                showStatus('食物链中存在循环，这是不合理的');
                playSound(false);
                return;
            }
            let allConsumersHaveFood = true;
            consumers.forEach(id => {
                const creature = creaturesData.find(c => c.id === id);
                const possiblePrey = creature.prey.filter(preyId => requiredCreatures.includes(preyId));
                const hasFood = possiblePrey.some(preyId => foodWeb.get(id).prey.has(preyId));
                if (!hasFood && possiblePrey.length > 0) {
                    allConsumersHaveFood = false;
                    showStatus(`${creature.name} 没有食物来源`);
                }
            });
            if (!allConsumersHaveFood) {
                playSound(false);
                return;
            }
            let hasProducerConsumerConnection = false;
            if (consumers.length > 0) {
                producers.forEach(producerId => {
                    if (foodWeb.get(producerId).predators.size > 0) {
                        hasProducerConsumerConnection = true;
                    }
                });
                if (!hasProducerConsumerConnection && producers.length > 0) {
                     showStatus('请连接生产者和消费者');
                     playSound(false);
                     return;
                }
            }
            showStatus('恭喜！您已构建了一个有效的食物链');
            playSound(true);
        }

        function hasCycle(foodWeb) {
            const visited = new Set();
            const recursionStack = new Set();
            function dfs(node) {
                if (!visited.has(node)) {
                    visited.add(node);
                    recursionStack.add(node);
                    const predators = Array.from(foodWeb.get(node).predators);
                    for (const predator of predators) {
                        if (!visited.has(predator)) {
                            if (dfs(predator)) return true;
                        } else if (recursionStack.has(predator)) {
                            return true;
                        }
                    }
                }
                recursionStack.delete(node);
                return false;
            }
            for (const node of foodWeb.keys()) {
                if (dfs(node)) return true;
            }
            return false;
        }

        function playSound(isSuccess) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                if (isSuccess) {
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(880, audioContext.currentTime + 0.5);
                } else {
                    oscillator.type = 'sawtooth';
                    oscillator.frequency.setValueAtTime(220, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(110, audioContext.currentTime + 0.3);
                }
                gainNode.gain.exponentialRampToValueAtTime(0.00001, audioContext.currentTime + (isSuccess ? 0.5 : 0.3));
                oscillator.start();
                oscillator.stop(audioContext.currentTime + (isSuccess ? 0.5 : 0.3));
            } catch (e) {
                console.error('无法播放音效:', e);
            }
        }

        function showStatus(message) {
            statusBar.textContent = message;
            statusBar.className = 'text-gray-700';
            setTimeout(() => {
                if (statusBar.textContent === message) {
                    statusBar.textContent = '准备就绪';
                    statusBar.className = 'text-gray-500';
                }
            }, 3000);
        }

        function showInfo(message) {
            infoPanel.classList.remove('hidden');
            infoPanel.classList.add('flex');
            setTimeout(() => {
                infoPanel.classList.add('hidden');
                infoPanel.classList.remove('flex');
            }, 3000);
        }

        function initEventListeners() {
            checkBtn.addEventListener('click', checkFoodChain);
            window.addEventListener('resize', updateConnections);
        }

        function initGame() {
            initLevelSelector();
            updateCreaturesContainer();
            initCanvasDrop();
            initEventListeners();
            levelInfo.textContent = `当前关卡: 第${gameState.currentLevel}关`;
            showStatus('游戏已准备就绪');
        }
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>